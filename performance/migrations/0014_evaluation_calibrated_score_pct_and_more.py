# Generated by Django 5.2.7 on 2025-11-25 21:25

import base.models
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('base', '0009_alter_company_managers_alter_partner_managers'),
        ('hr', '0005_alter_department_managers'),
        ('performance', '0013_alter_evaluationparameter_source_kind_dailyrating_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AddField(
            model_name='evaluation',
            name='calibrated_score_pct',
            field=models.PositiveIntegerField(blank=True, help_text='Final calibrated score (0..100). If null, use final_score_pct.', null=True),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='calibration_applied_at',
            field=models.DateTimeField(blank=True, help_text='When calibration was applied.', null=True),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='calibration_applied_by',
            field=models.ForeignKey(blank=True, help_text='Who applied the calibration (usually manager/HR).', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='applied_evaluation_calibrations', to='hr.employee'),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='calibration_reason',
            field=models.TextField(blank=True, help_text='Reason for calibration / normalization.'),
        ),
        migrations.AddField(
            model_name='task',
            name='actual_minutes',
            field=models.PositiveIntegerField(default=0, help_text='Actual effort spent (minutes). Optional.'),
        ),
        migrations.AddField(
            model_name='task',
            name='estimated_minutes',
            field=models.PositiveIntegerField(default=0, help_text='Estimated effort for this task (minutes).'),
        ),
        migrations.AddField(
            model_name='task',
            name='priority',
            field=models.CharField(choices=[('low', 'Low'), ('normal', 'Normal'), ('high', 'High'), ('critical', 'Critical')], db_index=True, default='normal', max_length=16),
        ),
        migrations.AddField(
            model_name='task',
            name='quality_score_pct',
            field=models.PositiveIntegerField(default=0, help_text='Quality score (0–100), can be set manually or by QA process.'),
        ),
        migrations.AddField(
            model_name='task',
            name='task_kind',
            field=models.CharField(choices=[('planned', 'Planned Objective Task'), ('temporary', 'Temporary / Ad-hoc Task'), ('bau', 'BAU / Daily Operations Task')], db_index=True, default='planned', max_length=16),
        ),
        migrations.AddField(
            model_name='task',
            name='temporary_source_ref',
            field=models.CharField(blank=True, help_text='External reference ID (IncidentID, TicketID, etc.)', max_length=64),
        ),
        migrations.AddField(
            model_name='task',
            name='temporary_source_type',
            field=models.CharField(blank=True, help_text='Source of temporary task: NMS Incident, CRM Ticket, etc.', max_length=32),
        ),
        migrations.AlterField(
            model_name='evaluationparameter',
            name='source_kind',
            field=models.CharField(choices=[('objective_score', 'Objective Score (score_pct)'), ('objective_progress', 'Objective Progress (progress_pct)'), ('kpi_score', 'KPI Score (score_pct)'), ('tasks_progress', 'Tasks Progress (avg % complete)'), ('external_metric', 'External Metric (model/field/filter)'), ('manual', 'Manual Entry (default)'), ('daily_rating', 'Daily Rating (avg overall score)'), ('temp_tasks_load', 'Temporary Tasks Load Index'), ('temp_tasks_score', 'Temporary Tasks Performance Score'), ('employee_objective_score', 'Employee Objective Contribution Score'), ('quality_score', 'Quality / Mistakes / Complaints Score'), ('feedback_score', '360° Feedback (Self/Manager/Peers)')], default='manual', max_length=32),
        ),
        migrations.CreateModel(
            name='EvaluationCalibration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('old_score_pct', models.PositiveIntegerField(help_text='Evaluation final_score_pct before calibration.')),
                ('new_score_pct', models.PositiveIntegerField(help_text='Calibrated score (0..100).')),
                ('reason', models.TextField(blank=True)),
                ('applied_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evaluation_calibrations', to='hr.employee')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_set', to='base.company')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('evaluation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='calibrations', to='performance.evaluation')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'perf_evaluation_calibration',
                'ordering': ['-created_at'],
            },
            managers=[
                ('objects', base.models.CompanyScopeManager()),
            ],
        ),
        migrations.CreateModel(
            name='EvaluationFeedback',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('role', models.CharField(choices=[('self', 'Self'), ('manager', 'Direct Manager'), ('peer', 'Peer / Colleague'), ('skip_manager', 'Skip-level Manager'), ('hr', 'HR'), ('other', 'Other')], default='manager', max_length=16)),
                ('overall_score_pct', models.PositiveIntegerField(default=0, help_text='Overall feedback score (0..100).')),
                ('comment', models.TextField(blank=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_set', to='base.company')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('evaluation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='feedbacks', to='performance.evaluation')),
                ('from_employee', models.ForeignKey(blank=True, help_text='Employee giving the feedback (if applicable).', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='given_feedbacks', to='hr.employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'perf_evaluation_feedback',
                'ordering': ['evaluation', '-created_at'],
            },
            managers=[
                ('objects', base.models.CompanyScopeManager()),
            ],
        ),
        migrations.CreateModel(
            name='PerformanceException',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('date_start', models.DateField()),
                ('date_end', models.DateField()),
                ('impact_pct', models.FloatField(default=0.0, help_text='Optional explicit impact override. If set, overrides type.multiplier.')),
                ('notes', models.TextField(blank=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_set', to='base.company')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='performance_exceptions', to='hr.employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'perf_exception',
                'ordering': ['-date_start'],
            },
            managers=[
                ('objects', base.models.CompanyScopeManager()),
            ],
        ),
        migrations.CreateModel(
            name='EvaluationExceptionAdjustment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('adjustment_pct', models.FloatField(default=0.0, help_text='Final adjustment added to evaluation final score (can be negative or positive).')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('evaluation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exception_adjustments', to='performance.evaluation')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('exception', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evaluation_adjustments', to='performance.performanceexception')),
            ],
            options={
                'db_table': 'perf_evaluation_exception_adjustment',
                'ordering': ['-id'],
            },
        ),
        migrations.CreateModel(
            name='PerformanceExceptionType',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('active', models.BooleanField(db_index=True, default=True)),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('multiplier', models.FloatField(default=0.0, help_text='Impact multiplier applied to final score or specific parameters.')),
                ('is_positive', models.BooleanField(default=True, help_text='True = beneficial to employee (reduces penalty), False = negative.')),
                ('max_impact_pct', models.PositiveIntegerField(default=100, help_text='Maximum allowed impact from this exception type.')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_set', to='base.company')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'perf_exception_type',
                'ordering': ['company', 'name'],
                'unique_together': {('company', 'name')},
            },
            managers=[
                ('objects', base.models.CompanyScopeManager()),
            ],
        ),
        migrations.AddField(
            model_name='performanceexception',
            name='type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exceptions', to='performance.performanceexceptiontype'),
        ),
        migrations.CreateModel(
            name='QualityIncident',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_index=True)),
                ('date', models.DateField()),
                ('severity', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='medium', max_length=16)),
                ('impact_score_pct', models.PositiveIntegerField(default=100, help_text='0..100: higher means better handling, lower means worse')),
                ('description', models.TextField(blank=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='%(app_label)s_%(class)s_set', to='base.company')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quality_incidents', to='hr.employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'perf_quality_incident',
                'ordering': ['-date'],
            },
            managers=[
                ('objects', base.models.CompanyScopeManager()),
            ],
        ),
        migrations.AddIndex(
            model_name='performanceexception',
            index=models.Index(fields=['employee', 'date_start'], name='perf_except_employe_ddbc77_idx'),
        ),
        migrations.AddIndex(
            model_name='performanceexception',
            index=models.Index(fields=['type'], name='perf_except_type_id_eccdc8_idx'),
        ),
    ]
