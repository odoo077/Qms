{% extends "base.html" %}

{% block title %}
Asset · {{ object.code }}
{% endblock %}

{% block content %}
<div class="w-full px-6 py-6 space-y-6">

  <!-- ===================================================== -->
  <!-- PAGE HEADER -->
  <!-- ===================================================== -->
  <section class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="text-3xl font-semibold tracking-tight">
        {{ object.code }} — {{ object.name }}
      </h1>
      <p class="text-sm text-base-content/60">
        Asset details and assignment lifecycle
      </p>
    </div>

    <div class="flex flex-wrap gap-2">
      <a href="{% url 'assets:asset_list' %}"
         class="btn btn-ghost btn-sm">
        Back
      </a>

      <a href="{% url 'assets:asset_edit' object.id %}"
         class="btn btn-outline btn-sm">
        Edit
      </a>

      {% if object.active and object.status == "available" %}
        <a href="{% url 'assets:asset_assign' object.id %}"
           class="btn btn-primary btn-sm">
          Assign
        </a>
      {% endif %}

      {% if current_assignment %}
        <a href="{% url 'assets:asset_unassign' object.id %}"
           class="btn btn-outline btn-warning btn-sm">
          Unassign
        </a>
      {% endif %}
    </div>
  </section>

  <!-- ===================================================== -->
  <!-- STATUS BADGES -->
  <!-- ===================================================== -->
  <section class="flex flex-wrap gap-2">
    {% if object.active %}
      <span class="badge badge-success badge-sm">Active</span>
    {% else %}
      <span class="badge badge-ghost badge-sm">Archived</span>
    {% endif %}

    {% if object.status == "available" %}
      <span class="badge badge-success badge-sm">Available</span>
    {% elif object.status == "assigned" %}
      <span class="badge badge-primary badge-sm">Assigned</span>
    {% elif object.status == "maintenance" %}
      <span class="badge badge-warning badge-sm">Maintenance</span>
    {% else %}
      <span class="badge badge-ghost badge-sm">Retired</span>
    {% endif %}
  </section>

  <!-- ===================================================== -->
  <!-- ASSET INFORMATION -->
  <!-- ===================================================== -->
  <section class="card bg-base-100 border border-base-200 shadow-sm">
    <div class="p-6 space-y-6">

      <h2 class="text-base font-semibold tracking-wide">
        Asset Information
      </h2>

      <dl class="grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-4 text-sm">

        <div class="text-base-content/60">Code</div>
        <div class="font-mono font-medium md:col-span-2">
          {{ object.code }}
        </div>

        <div class="text-base-content/60">Name</div>
        <div class="md:col-span-2">
          {{ object.name }}
        </div>

        <div class="text-base-content/60">Company</div>
        <div class="md:col-span-2">
          {{ object.company }}
        </div>

        <div class="text-base-content/60">Category</div>
        <div class="md:col-span-2">
          {{ object.category|default:"—" }}
        </div>

        <div class="text-base-content/60">Department</div>
        <div class="md:col-span-2">
          {{ object.department|default:"—" }}
        </div>

        <div class="text-base-content/60">Parent Asset</div>
        <div class="md:col-span-2">
          {% if object.parent %}
            <a href="{% url 'assets:asset_detail' object.parent.id %}"
               class="link link-hover font-medium">
              {{ object.parent }}
            </a>
          {% else %}
            —
          {% endif %}
        </div>

        <div class="text-base-content/60">Purchase Date</div>
        <div class="md:col-span-2">
          {{ object.purchase_date|date:"Y-m-d"|default:"—" }}
        </div>

        <div class="text-base-content/60">Purchase Value</div>
        <div class="md:col-span-2">
          {% if object.purchase_value %}
            {{ object.purchase_value }}
          {% else %}
            —
          {% endif %}
        </div>

      </dl>

      {% if object.note %}
        <div class="pt-4 border-t border-base-200">
          <div class="text-xs uppercase tracking-wide text-base-content/60 mb-1">
            Notes
          </div>
          <p class="text-sm text-base-content/80 whitespace-pre-line">
            {{ object.note }}
          </p>
        </div>
      {% endif %}

    </div>
  </section>

  <!-- ===================================================== -->
  <!-- CURRENT ASSIGNMENT -->
  <!-- ===================================================== -->
  <section class="card bg-base-100 border border-base-200 shadow-sm">
    <div class="p-6 space-y-4">

      <h2 class="text-base font-semibold tracking-wide">
        Current Assignment
      </h2>

      {% if current_assignment %}
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-sm">

          <div>
            <div class="text-base-content/60">Employee</div>
            <div class="font-medium">
              {{ current_assignment.employee }}
            </div>
          </div>

          <div>
            <div class="text-base-content/60">Assigned From</div>
            <div>
              {{ current_assignment.date_from|date:"Y-m-d" }}
            </div>
          </div>

          <div>
            <div class="text-base-content/60">Holding Duration</div>
            <div class="font-semibold">
              {{ current_assignment.date_from|timesince }}
            </div>
          </div>

          <div>
            <div class="text-base-content/60">State</div>
            <span class="badge badge-primary badge-sm">
              Active
            </span>
          </div>

        </div>
      {% else %}
        <p class="text-sm text-base-content/60">
          This asset is currently not assigned.
        </p>
      {% endif %}

    </div>
  </section>

  <!-- ===================================================== -->
  <!-- ASSIGNMENT HISTORY -->
  <!-- ===================================================== -->
  <section class="card bg-base-100 border border-base-200 shadow-sm overflow-x-auto">
    <div class="p-6 space-y-4">

      <h2 class="text-base font-semibold tracking-wide">
        Assignment History
      </h2>

      <table class="table w-full text-sm">
        <thead class="bg-base-200/60">
          <tr>
            <th>Employee</th>
            <th>From</th>
            <th>To</th>
            <th>Duration</th>
            <th>Status</th>
          </tr>
        </thead>

        <tbody>
          {% for asg in assignment_history %}
          <tr>

            <td class="font-medium">
              {{ asg.employee }}
            </td>

            <td>
              {{ asg.date_from|date:"Y-m-d"|default:"—" }}
            </td>

            <td>
              {{ asg.date_to|date:"Y-m-d"|default:"—" }}
            </td>

            <td>
              {% if asg.date_to %}
                {{ asg.date_from|timesince:asg.date_to }}
              {% else %}
                {{ asg.date_from|timesince }}
              {% endif %}
            </td>

            <td>
              {% if asg.date_to %}
                <span class="badge badge-ghost badge-sm">Closed</span>
              {% else %}
                <span class="badge badge-primary badge-sm">Active</span>
              {% endif %}
            </td>

          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="py-8 text-center text-base-content/60">
              No assignment history available.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>
  </section>

</div>
{% endblock %}
