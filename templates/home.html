{# templates/home.html #}
{% extends "base.html" %}

{% block title %}Dashboard · 360 Manager{% endblock %}

{% block header_title %}Dashboard{% endblock %}


{% block page_actions %}
<form method="get" class="flex items-center gap-2">
  <label class="input input-sm input-bordered flex items-center gap-2 w-72">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" viewBox="0 0 24 24" fill="none">
      <path d="M21 21l-4.3-4.3m1.8-5.2a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <input name="q" value="{{ search.q }}" class="grow" placeholder="Quick search (employee, asset, partner)..." />
  </label>
  <button class="btn btn-sm btn-primary">Search</button>
  {% if search.q %}
    <a href="?" class="btn btn-sm btn-ghost">Reset</a>
  {% endif %}
</form>
{% endblock %}
{% block content %}
<div class="space-y-6">


  {# ========================================================= #}
  {# QUICK ACTIONS #}
  {# ========================================================= #}
  <section class="rounded-2xl border border-base-200 bg-base-100">
    <div class="p-4 border-b border-base-200">
      <h2 class="font-semibold">Quick Actions</h2>
      <p class="text-sm opacity-70">Common operations</p>
    </div>
    <div class="p-4 flex flex-wrap gap-2">
      <a href="{{ urls.employees_create }}" class="btn btn-sm btn-outline">Add Employee</a>
      <a href="{{ urls.assets_create }}" class="btn btn-sm btn-outline">Add Asset</a>
      <a href="{{ urls.payslips_create }}" class="btn btn-sm btn-outline">Create Payslip</a>
      <a href="{{ urls.partners_create }}" class="btn btn-sm btn-outline">Add Partner</a>
    </div>
  </section>

  {# ========================================================= #}
  {# KPI STRIP (Compact) #}
  {# ========================================================= #}
  <section class="grid grid-cols-2 md:grid-cols-4 xl:grid-cols-8 gap-3">
    <div class="rounded-xl border border-base-200 bg-base-100 p-3">
      <div class="text-xs uppercase tracking-wide opacity-60">Companies</div>
      <div class="mt-1 text-2xl font-semibold text-primary">{{ companies_count|default:"0" }}</div>
    </div>

    <div class="rounded-xl border border-base-200 bg-base-100 p-3">
      <div class="text-xs uppercase tracking-wide opacity-60">Partners</div>
      <div class="mt-1 text-2xl font-semibold">{{ partners_count|default:"0" }}</div>
    </div>

    <div class="rounded-xl border border-base-200 bg-base-100 p-3">
      <div class="text-xs uppercase tracking-wide opacity-60">Users</div>
      <div class="mt-1 text-2xl font-semibold">{{ users_count|default:"0" }}</div>
    </div>

    <div class="rounded-xl border border-base-200 bg-base-100 p-3">
      <div class="text-xs uppercase tracking-wide opacity-60">Employees</div>
      <div class="mt-1 text-2xl font-semibold text-secondary">{{ employees_count|default:"0" }}</div>
    </div>

    <div class="rounded-xl border border-base-200 bg-base-100 p-3">
      <div class="text-xs uppercase tracking-wide opacity-60">Assets</div>
      <div class="mt-1 text-2xl font-semibold text-secondary">{{ assets_count|default:"0" }}</div>
    </div>

    <div class="rounded-xl border border-base-200 bg-base-100 p-3">
      <div class="text-xs uppercase tracking-wide opacity-60">Skills</div>
      <div class="mt-1 text-2xl font-semibold">{{ skills_count|default:"0" }}</div>
    </div>

    <div class="rounded-xl border border-base-200 bg-base-100 p-3">
      <div class="text-xs uppercase tracking-wide opacity-60">Employee Skills</div>
      <div class="mt-1 text-2xl font-semibold">{{ employee_skills_count|default:"0" }}</div>
    </div>

    <div class="rounded-xl border border-base-200 bg-base-100 p-3">
      <div class="text-xs uppercase tracking-wide opacity-60">Payslips</div>
      <div class="mt-1 text-2xl font-semibold text-accent">{{ payslips_count|default:"0" }}</div>
      <div class="text-xs opacity-60 mt-1">All states</div>
    </div>
  </section>

  {# ========================================================= #}
  {# STATUS SNAPSHOTS (Assets / Payslips) #}
  {# ========================================================= #}
  <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    <div class="rounded-2xl border border-base-200 bg-base-100">
      <div class="p-4 border-b border-base-200 flex items-center justify-between">
        <div class="font-semibold">Assets by Status</div>
        <a href="{{ urls.assets_list }}" class="link link-hover text-sm">Open Assets</a>
      </div>
      <div class="p-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
          <div class="rounded-xl bg-base-200/40 p-3">
            <div class="opacity-70 text-xs uppercase">Available</div>
            <div class="text-xl font-semibold mt-1">{{ assets_by_status.available|default:"0" }}</div>
          </div>
          <div class="rounded-xl bg-base-200/40 p-3">
            <div class="opacity-70 text-xs uppercase">Assigned</div>
            <div class="text-xl font-semibold mt-1">{{ assets_by_status.assigned|default:"0" }}</div>
          </div>
          <div class="rounded-xl bg-base-200/40 p-3">
            <div class="opacity-70 text-xs uppercase">Maintenance</div>
            <div class="text-xl font-semibold mt-1">{{ assets_by_status.maintenance|default:"0" }}</div>
          </div>
          <div class="rounded-xl bg-base-200/40 p-3">
            <div class="opacity-70 text-xs uppercase">Retired</div>
            <div class="text-xl font-semibold mt-1">{{ assets_by_status.retired|default:"0" }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="rounded-2xl border border-base-200 bg-base-100">
      <div class="p-4 border-b border-base-200 flex items-center justify-between">
        <div class="font-semibold">Payslips by State</div>
        <a href="{{ urls.payslips_list }}" class="link link-hover text-sm">Open Payslips</a>
      </div>
      <div class="p-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
          <div class="rounded-xl bg-base-200/40 p-3">
            <div class="opacity-70 text-xs uppercase">Draft</div>
            <div class="text-xl font-semibold mt-1">{{ payslips_by_state.draft|default:"0" }}</div>
          </div>
          <div class="rounded-xl bg-base-200/40 p-3">
            <div class="opacity-70 text-xs uppercase">Validated</div>
            <div class="text-xl font-semibold mt-1">{{ payslips_by_state.validated|default:"0" }}</div>
          </div>
          <div class="rounded-xl bg-base-200/40 p-3">
            <div class="opacity-70 text-xs uppercase">Paid</div>
            <div class="text-xl font-semibold mt-1">{{ payslips_by_state.paid|default:"0" }}</div>
          </div>
          <div class="rounded-xl bg-base-200/40 p-3">
            <div class="opacity-70 text-xs uppercase">Cancelled</div>
            <div class="text-xl font-semibold mt-1">{{ payslips_by_state.cancel|default:"0" }}</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  {# ========================================================= #}
  {# QUICK SEARCH RESULTS (only when q exists) #}
  {# ========================================================= #}
  {% if search.q %}
  <section class="rounded-2xl border border-base-200 bg-base-100">
    <div class="p-4 border-b border-base-200">
      <h2 class="font-semibold">Search Results</h2>
      <p class="text-sm opacity-70">Top matches for “{{ search.q }}”</p>
    </div>

    <div class="p-4 grid grid-cols-1 lg:grid-cols-3 gap-4">

      <div>
        <div class="text-sm font-semibold mb-2">Partners</div>
        <div class="space-y-2">
          {% for p in search.partners %}
            <div class="flex items-center justify-between rounded-xl border border-base-200 p-3">
              <div class="min-w-0">
                <div class="truncate font-medium">{{ p.name }}</div>
                <div class="text-xs opacity-60 truncate">{{ p.company }}</div>
              </div>
              <a class="btn btn-xs btn-ghost" href="{{ p.open_url }}">Open</a>
            </div>
          {% empty %}
            <div class="text-sm opacity-60">No matches</div>
          {% endfor %}
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold mb-2">Employees</div>
        <div class="space-y-2">
          {% for e in search.employees %}
            <div class="flex items-center justify-between rounded-xl border border-base-200 p-3">
              <div class="min-w-0">
                <div class="truncate font-medium">{{ e.name }}</div>
                <div class="text-xs opacity-60 truncate">{{ e.department }}</div>
              </div>
              <a class="btn btn-xs btn-ghost" href="{{ e.open_url }}">Open</a>
            </div>
          {% empty %}
            <div class="text-sm opacity-60">No matches</div>
          {% endfor %}
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold mb-2">Assets</div>
        <div class="space-y-2">
          {% for a in search.assets %}
            <div class="flex items-center justify-between rounded-xl border border-base-200 p-3">
              <div class="min-w-0">
                <div class="truncate font-medium">{{ a.code }} — {{ a.name }}</div>
                <div class="text-xs opacity-60 truncate">{{ a.company }}</div>
              </div>
              <a class="btn btn-xs btn-ghost" href="{{ a.open_url }}">Open</a>
            </div>
          {% empty %}
            <div class="text-sm opacity-60">No matches</div>
          {% endfor %}
        </div>
      </div>

    </div>
  </section>
  {% endif %}

  {# ========================================================= #}
  {# RECENT ACTIVITY (compact lists, no big cards) #}
  {# ========================================================= #}
  <section class="grid grid-cols-1 xl:grid-cols-2 gap-4">

    <div class="rounded-2xl border border-base-200 bg-base-100">
      <div class="p-4 border-b border-base-200 flex items-center justify-between">
        <div>
          <div class="font-semibold">Recent Employees</div>
        </div>
        <a href="{{ urls.employees_list }}" class="link link-hover text-sm">View all</a>
      </div>
      <div class="p-2">
        <div class="overflow-x-auto">
          <table class="table table-sm">
            <tbody>
              {% for e in recent_employees %}
              <tr>
                <td class="font-medium">{{ e.name }}</td>
                <td class="opacity-70">{{ e.department }}</td>
                <td class="text-right">
                  <a class="btn btn-xs btn-ghost" href="{{ e.open_url }}">Open</a>
                </td>
              </tr>
              {% empty %}
              <tr><td class="opacity-60">No recent employees</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="rounded-2xl border border-base-200 bg-base-100">
      <div class="p-4 border-b border-base-200 flex items-center justify-between">
        <div>
          <div class="font-semibold">Recent Assets</div>
        </div>
        <a href="{{ urls.assets_list }}" class="link link-hover text-sm">View all</a>
      </div>
      <div class="p-2">
        <div class="overflow-x-auto">
          <table class="table table-sm">
            <tbody>
              {% for a in recent_assets %}
              <tr>
                <td class="font-medium">{{ a.code }}</td>
                <td class="truncate">{{ a.name }}</td>
                <td class="opacity-70">{{ a.status }}</td>
                <td class="text-right">
                  <a class="btn btn-xs btn-ghost" href="{{ a.open_url }}">Open</a>
                </td>
              </tr>
              {% empty %}
              <tr><td class="opacity-60">No recent assets</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="rounded-2xl border border-base-200 bg-base-100">
      <div class="p-4 border-b border-base-200 flex items-center justify-between">
        <div class="font-semibold">Recent Partners</div>
        <a href="{{ urls.partners_list }}" class="link link-hover text-sm">View all</a>
      </div>
      <div class="p-2">
        <table class="table table-sm">
          <tbody>
            {% for p in recent_partners %}
            <tr>
              <td class="font-medium">{{ p.name }}</td>
              <td class="opacity-70">{{ p.company }}</td>
              <td class="text-right">
                <a class="btn btn-xs btn-ghost" href="{{ p.open_url }}">Open</a>
              </td>
            </tr>
            {% empty %}
            <tr><td class="opacity-60">No recent partners</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="rounded-2xl border border-base-200 bg-base-100">
      <div class="p-4 border-b border-base-200 flex items-center justify-between">
        <div class="font-semibold">Recent Payslips</div>
        <a href="{{ urls.payslips_list }}" class="link link-hover text-sm">View all</a>
      </div>
      <div class="p-2">
        <table class="table table-sm">
          <tbody>
            {% for ps in recent_payslips %}
            <tr>
              <td class="font-medium">{{ ps.employee }}</td>
              <td class="opacity-70">{{ ps.period }}</td>
              <td class="opacity-70">{{ ps.state }}</td>
              <td class="text-right">
                <a class="btn btn-xs btn-ghost" href="{{ ps.open_url }}">Open</a>
              </td>
            </tr>
            {% empty %}
            <tr><td class="opacity-60">No recent payslips</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </section>



</div>
{% endblock %}
