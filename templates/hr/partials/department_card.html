{# expects: node #}
{% with dept=node.obj %}

<div class="ml-{{ node.depth|add:1 }}">

  {% if node.has_children %}
    <details class="group"
             {% if node.depth == 0 %}open{% endif %}>

      <summary class="flex items-center justify-between cursor-pointer
                      rounded-lg px-4 py-3
                      bg-base-200 hover:bg-base-300
                      transition">

        <!-- Left: Name + Badges -->
        <div class="flex items-center gap-3 min-w-0">

          <!-- Arrow -->
          <span class="transition-transform group-open:rotate-90 opacity-60">
            â–¶
          </span>

          <span class="font-medium truncate">
            {{ dept.name }}
          </span>

          <span class="badge badge-outline badge-sm">
            {{ dept.level|title }}
          </span>

          <span class="badge badge-ghost badge-sm">
            {{ dept.employee_count }} employees
          </span>

        </div>

        <!-- Right: Actions -->
        <a href="{% url 'hr:department_detail' dept.pk %}"
           class="btn btn-xs btn-outline"
           onclick="event.stopPropagation()">
          View
        </a>

      </summary>

      <!-- Children -->
      <div class="mt-3 space-y-3">
        {% for child in node.children %}
          {% include "hr/partials/department_card.html" with node=child %}
        {% endfor %}
      </div>

    </details>

  {% else %}
    <!-- Leaf (Team) -->
    <div class="flex items-center justify-between
                rounded-lg px-4 py-3
                bg-base-100 border border-base-300">

      <div class="flex items-center gap-3 min-w-0">
        <span class="font-medium truncate">
          {{ dept.name }}
        </span>

        <span class="badge badge-ghost badge-sm">
          {{ dept.employee_count }} employees
        </span>
      </div>

      <a href="{% url 'hr:department_detail' dept.pk %}"
         class="btn btn-xs btn-outline">
        View
      </a>

    </div>
  {% endif %}

</div>

{% endwith %}
