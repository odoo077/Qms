{% extends "base.html" %}
{% load performance_permissions %}

{% block title %}Objectives{% endblock %}
{% block page_title %}Performance{% endblock %}
{% block header_title %}Objectives{% endblock %}
{% block header_subtitle %}Manage performance objectives{% endblock %}

{% block page_actions %}
  {% if can_add_objective %}
    <a href="{% url 'performance:objective_create' %}" class="btn btn-primary btn-sm">
      New Objective
    </a>
  {% endif %}
{% endblock %}

{% block content %}
<div class="card bg-base-100 shadow">
  <div class="card-body">

    {# يمكن لاحقاً إضافة فورم بحث مثل بقية الصفحات إن رغبت #}

    <div class="overflow-x-auto">
      <table class="table table-zebra table-sm">
        <thead>
          <tr>
            <th>#</th>
            <th>Title</th>
            <th>Target</th>
            <th>Reviewer</th>
            <th>Period</th>
            <th>Status</th>
            <th class="text-right">Progress</th>
            <th class="text-right">Score</th>
            <th class="w-32 text-right">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% if object_list %}
            {% for obj in object_list %}
              <tr>
                <td>{{ forloop.counter }}</td>

                <td>
                  <a href="{% url 'performance:objective_detail' obj.pk %}" class="link link-hover">
                    {{ obj.title }}
                  </a>
                  {% if obj.code %}
                    <div class="text-xs opacity-70">
                      {{ obj.code }}
                    </div>
                  {% endif %}
                </td>

                <td>
                  {# عرض الهدف حسب نوع الـ target_kind #}
                  {% if obj.target_kind == "company" %}
                    <span class="badge badge-outline badge-sm">Company-wide</span>
                  {% elif obj.target_kind == "department" %}
                    {{ obj.target_department }}
                  {% elif obj.target_kind == "employee" %}
                    {{ obj.target_employee }}
                  {% else %}
                    -
                  {% endif %}
                </td>

                <td>
                  {{ obj.reviewer|default:"-" }}
                </td>

                <td>
                  {{ obj.date_start }} – {{ obj.date_end }}
                </td>

                <td>
                  {{ obj.get_status_display|default:obj.status }}
                </td>

                <td class="text-right">
                  {% if obj.progress_pct is not None %}
                    {{ obj.progress_pct }}%
                  {% else %}
                    -
                  {% endif %}
                </td>

                <td class="text-right">
                  {% if obj.score_pct is not None %}
                    {{ obj.score_pct }}%
                  {% else %}
                    -
                  {% endif %}
                </td>

                <td class="text-right">
                  <div class="flex justify-end gap-1">
                    {% if obj.can_view %}
                      <a href="{% url 'performance:objective_detail' obj.pk %}"
                         class="btn btn-ghost btn-xs">
                        View
                      </a>
                    {% endif %}

                    {% if obj.can_edit %}
                      <a href="{% url 'performance:objective_update' obj.pk %}"
                         class="btn btn-ghost btn-xs">
                        Edit
                      </a>
                    {% endif %}

                    {% if obj.can_delete %}
                      <a href="{% url 'performance:objective_delete' obj.pk %}"
                         class="btn btn-ghost btn-xs text-error">
                        Delete
                      </a>
                    {% endif %}
                  </div>
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="9" class="text-center text-sm opacity-70">
                No objectives found.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    {% include "partials/paginator.html" with page_obj=page_obj %}
  </div>
</div>
{% endblock %}
