{% extends "base.html" %}
{% block content %}
<!-- صفحة تفاصيل الهدف مع روابط فرعية للتعيينات والمهام/KPIs -->

<div class="max-w-5xl mx-auto p-4 space-y-6">
  <!-- رأس الصفحة -->
  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-2xl font-semibold">{{ object.title }}</h1>
      <div class="opacity-70 font-mono">{{ object.code }}</div>
      <div class="opacity-70">Period: {{ object.date_start }} → {{ object.date_end }}</div>
      <div class="opacity-70">Status: {{ object.status }}</div>
    </div>
    <div class="flex gap-2">
      <a class="btn" href="{% url 'performance:objective_update' pk=object.pk %}">Edit</a>
      <a class="btn btn-error" href="{% url 'performance:objective_delete' pk=object.pk %}">Delete</a>
      <a class="btn" href="{% url 'performance:objective_list' %}">Back</a>
    </div>
  </div>

  <!-- مقاييس مختصرة -->
  <div class="grid md:grid-cols-3 gap-3">
    <div class="card bg-base-200 p-4">
      <div class="text-sm opacity-70">Weight</div>
      <div class="text-2xl font-semibold">{{ object.weight_pct }}%</div>
    </div>
    <div class="card bg-base-200 p-4">
      <div class="text-sm opacity-70">Progress</div>
      <div class="text-2xl font-semibold">{{ object.progress_pct }}%</div>
    </div>
    <div class="card bg-base-200 p-4">
      <div class="text-sm opacity-70">Score</div>
      <div class="text-2xl font-semibold">{{ object.score_pct }}%</div>
    </div>
  </div>

  <!-- روابط التعيينات -->
  <div class="card bg-base-100 shadow p-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold">Assignments & Participants</h2>
      <div class="flex gap-2">
        <a class="btn btn-sm" href="{% url 'performance:objective_department_assignment_list' pk=object.pk %}">Departments</a>
        <a class="btn btn-sm" href="{% url 'performance:objective_employee_assignment_list' pk=object.pk %}">Employees</a>
        <form method="post" action="{% url 'performance:objective_rebuild_participants' pk=object.pk %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm btn-secondary">Rebuild Participants</button>
        </form>
      </div>
    </div>
  </div>

  <!-- روابط KPIs والمهام -->
  <div class="grid md:grid-cols-2 gap-3">
    <div class="card bg-base-100 shadow p-4">
      <div class="flex items-center justify-between mb-2">
        <h2 class="font-semibold">KPIs</h2>
        <a class="btn btn-sm" href="{% url 'performance:kpi_list' %}?q={{ object.code }}">Open KPI list</a>
      </div>
      <p class="opacity-70">Manage KPIs from the KPI list. You can link KPIs to this objective from KPI form.</p>
    </div>
    <div class="card bg-base-100 shadow p-4">
      <div class="flex items-center justify-between mb-2">
        <h2 class="font-semibold">Tasks</h2>
        <a class="btn btn-sm" href="{% url 'performance:task_list' %}?q={{ object.title }}">Open Task list</a>
      </div>
      <p class="opacity-70">Create tasks and link them to this objective (and optionally to a KPI).</p>
    </div>
  </div>
</div>
{% endblock %}
