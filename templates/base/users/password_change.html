{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}
Change Password · 360 Manager
{% endblock %}

{# ===================================================== #}
{# Page Header                                           #}
{# ===================================================== #}
{% block page_title %}Profile{% endblock %}

{% block header_title %}
Change password
{% endblock %}

{% block header_subtitle %}
Update your password to keep your account secure.
{% endblock %}

{% block page_actions %}
<a href="{% url 'base:profile' %}" class="btn btn-ghost btn-sm">
  ← Back to profile
</a>
{% endblock %}

{# ===================================================== #}
{# Page Content                                          #}
{# ===================================================== #}
{% block content %}

<div class="max-w-3xl mx-auto space-y-6">

  {# ===================================================== #}
  {# Security Notice                                      #}
  {# ===================================================== #}
  <div class="alert alert-info text-sm">
    <svg xmlns="http://www.w3.org/2000/svg"
         class="h-5 w-5 shrink-0"
         fill="none"
         viewBox="0 0 24 24"
         stroke="currentColor">
      <path stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 11c0 1.657-1.343 3-3 3m6-3c0 1.657 1.343 3 3 3M12 11V7m0 4v4m0 0H8m4 0h4" />
    </svg>
    <span>
      For security reasons, you will be required to log in again after changing your password.
    </span>
  </div>

  {# ===================================================== #}
  {# Change Password Form                                 #}
  {# ===================================================== #}
  <div class="card bg-base-100 border border-base-300">
    <div class="card-body p-6 space-y-6">

      <h2 class="text-sm font-semibold text-base-content/70">
        Password update
      </h2>

      {% if form.non_field_errors %}
        <div class="alert alert-error text-sm">
          <ul class="list-disc list-inside">
            {% for err in form.non_field_errors %}
              <li>{{ err }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <form method="post" novalidate class="space-y-5">
        {% csrf_token %}

        {# ---------- Current password ---------- #}
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">
              Current password
            </span>
          </label>
          {% render_field form.old_password class="input input-bordered w-full" %}
          {% if form.old_password.errors %}
            <p class="mt-1 text-xs text-error">
              {{ form.old_password.errors|striptags }}
            </p>
          {% endif %}
        </div>

        {# ---------- New password ---------- #}
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">
              New password
            </span>
          </label>
          {% render_field form.new_password1 class="input input-bordered w-full" %}

          {% if form.new_password1.help_text %}
            <div class="mt-2 text-xs text-base-content/60 prose prose-sm max-w-none">
              {{ form.new_password1.help_text|safe }}
            </div>
          {% endif %}

          {% if form.new_password1.errors %}
            <p class="mt-1 text-xs text-error">
              {{ form.new_password1.errors|striptags }}
            </p>
          {% endif %}
        </div>

        {# ---------- Confirm password ---------- #}
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">
              Confirm new password
            </span>
          </label>
          {% render_field form.new_password2 class="input input-bordered w-full" %}
          {% if form.new_password2.errors %}
            <p class="mt-1 text-xs text-error">
              {{ form.new_password2.errors|striptags }}
            </p>
          {% endif %}
        </div>

        {# ===================================================== #}
        {# Actions                                               #}
        {# ===================================================== #}
        <div class="flex items-center gap-3 pt-4">

          <button type="submit" class="btn btn-primary">
            Change password
          </button>

          <a href="{% url 'base:profile' %}" class="btn btn-ghost">
            Cancel
          </a>

        </div>

      </form>

    </div>
  </div>

  {# ===================================================== #}
  {# Password Reset Fallback                               #}
  {# ===================================================== #}
  <div class="text-center text-sm text-base-content/60">
    Forgot your password?
    <a href="{% url 'base:password_reset' %}"
       class="link link-hover font-medium">
      Reset it here
    </a>.
  </div>

</div>

{% endblock %}
